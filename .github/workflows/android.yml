name: Build Kivy APK

on:
  workflow_dispatch:
  push:
    branches:
      - master

jobs:
  build:
    runs-on: ubuntu-latest

    defaults:
      run:
        shell: bash

    env:
      ANDROID_HOME: ${{ github.workspace }}/android-sdk
      ANDROID_SDK_ROOT: ${{ github.workspace }}/android-sdk
      PATH: ${{ github.workspace }}/android-sdk/cmdline-tools/latest/bin:${{ github.workspace }}/android-sdk/platform-tools:$PATH

    steps:
      - name: Check environment
        run: |
          echo "Shell: $SHELL"
          which apt-get
          lsb_release -a || cat /etc/os-release

      - name: Install basic system tools
        run: |
          apt-get update
          apt-get install -y tar git unzip wget openjdk-17-jdk python3-pip build-essential \
            libffi-dev libssl-dev libsqlite3-dev zlib1g-dev libncurses5-dev \
            libgdbm-dev libnss3-dev libreadline-dev libbz2-dev
